<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image Converter • Bright Blue</title>
  <style>
    :root{
      --blue:#0ea5ff;           /* bright blue */
      --blue-600:#0284c7;
      --blue-700:#0369a1;
      --bg:#ffffff;             /* white */
      --text:#0b1220;           /* dark text */
      --muted:#6b7280;          /* gray */
      --ring: rgba(14,165,255,.35);
      --card:#ffffff;
    }

    *{ box-sizing:border-box; }
    html, body{
      height:100%;
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--text);
      background:linear-gradient(180deg, #f8fbff 0%, #ffffff 40%);
    }

    .container{
      max-width:1000px;
      margin:0 auto;
      padding:clamp(16px, 3vw, 32px);
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:20px;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
    }
    .logo{
      width:44px; height:44px; border-radius:14px;
      background: radial-gradient(100% 100% at 30% 20%, #67e8f9 0%, var(--blue) 40%, var(--blue-700) 100%);
      box-shadow: 0 8px 24px rgba(14,165,255,.35), inset 0 0 12px rgba(255,255,255,.6);
    }
    h1{
      font-size: clamp(20px, 3.2vw, 28px);
      margin:0;
      letter-spacing:.2px;
    }
    .subtitle{ color:var(--muted); font-size:14px; margin-top:2px; }

    .card{
      background: var(--card);
      border-radius: 18px;
      padding: clamp(14px, 3vw, 22px);
      box-shadow: 0 12px 30px rgba(2,132,199,.10);
      border: 1px solid rgba(14,165,255,.15);
    }

    .grid{
      display:grid; gap:16px; grid-template-columns: 1fr 1fr;
    }
    @media (max-width: 900px){ .grid{ grid-template-columns: 1fr; } }

    /* Upload */
    .dropzone{
      position:relative;
      border:2px dashed var(--blue-600);
      border-radius:16px;
      padding:24px;
      display:flex; flex-direction:column; align-items:center; justify-content:center; gap:10px;
      background: #f0f9ff;
      cursor:pointer;
      transition:.2s ease;
    }
    .dropzone:hover{ background:#e0f2ff; }
    .dropzone input{ display:none; }
    .dz-title{ font-weight:600; }
    .dz-hint{ color:var(--muted); font-size:13px; }

    /* Controls */
    .controls{ display:grid; gap:14px; grid-template-columns: 1fr 1fr; align-items:center; }
    .controls .full{ grid-column: 1 / -1; }
    @media (max-width: 520px){ .controls{ grid-template-columns: 1fr; } }

    label{ font-size:14px; color:#0f172a; font-weight:600; }
    select, input[type="range"], button{
      width:100%;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid rgba(2,132,199,.35);
      background:#ffffff;
      outline:none;
      transition:border-color .15s ease, box-shadow .15s ease, transform .02s ease;
    }
    select:focus, input[type="range"]:focus, button:focus{
      border-color: var(--blue);
      box-shadow: 0 0 0 4px var(--ring);
    }

    .range-wrap{ display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center; }
    .pill{ font-size:12px; padding:6px 10px; border-radius:999px; background:#eff6ff; border:1px solid rgba(2,132,199,.25); }

    button.primary{
      background:linear-gradient(180deg, var(--blue) 0%, var(--blue-600) 100%);
      color:#fff; border:none; font-weight:700;
    }
    button.primary:active{ transform: translateY(1px); }
    button.secondary{ background:#f8fbff; }
    .actions{ display:flex; gap:10px; }
    @media (max-width: 520px){ .actions{ flex-direction:column; } }

    /* Preview */
    .preview{
      background:#ffffff;
      border-radius:16px; border:1px solid rgba(2,132,199,.20);
      min-height:260px;
      display:flex; align-items:center; justify-content:center; overflow:hidden;
      position:relative;
    }
    .preview img{ max-width:100%; height:auto; display:block; }
    .meta{
      position:absolute; left:10px; bottom:10px;
      display:flex; gap:8px; flex-wrap:wrap;
    }
    .chip{ font-size:12px; padding:6px 10px; border-radius:999px; background:#ffffff; border:1px solid rgba(2,132,199,.25); box-shadow: 0 4px 10px rgba(2,132,199,.12); }

    .footer-note{ margin-top:16px; color:var(--muted); font-size:12px; text-align:center; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Image Converter</h1>
          <div class="subtitle">Convert formats • Compress • Mobile‑friendly</div>
        </div>
      </div>
    </header>

    <div class="card">
      <div class="grid">
        <!-- Left: Uploader & Controls -->
        <div>
          <label for="file">Upload image</label>
          <label class="dropzone" id="dropzone">
            <input id="file" type="file" accept="image/*" />
            <div class="dz-title">Drop an image here or tap to browse</div>
            <div class="dz-hint">PNG • JPG • WebP • GIF • etc.</div>
          </label>

          <div style="height:14px"></div>

          <div class="controls">
            <div>
              <label for="format">Output format</label>
              <select id="format">
                <option value="image/webp">WebP (recommended)</option>
                <option value="image/jpeg">JPEG</option>
                <option value="image/png">PNG</option>
                <option value="image/avif">AVIF (if supported)</option>
              </select>
            </div>

            <div>
              <label for="quality">Quality</label>
              <div class="range-wrap">
                <input id="quality" type="range" min="0.1" max="1" step="0.05" value="0.8" />
                <span class="pill" id="qualityValue">80%</span>
              </div>
            </div>

            <div class="full actions">
              <button class="secondary" id="resetBtn" disabled>Reset</button>
              <button class="primary" id="convertBtn" disabled>Convert & Download</button>
            </div>
          </div>
        </div>

        <!-- Right: Preview -->
        <div>
          <div class="preview" id="preview">
            <span class="dz-hint">Your preview will appear here</span>
            <div class="meta" id="meta" hidden>
              <span class="chip" id="dims">—</span>
              <span class="chip" id="origSize">—</span>
              <span class="chip" id="outSize">—</span>
              <span class="chip" id="note">—</span>
            </div>
          </div>
          <div class="footer-note">Transparency becomes white when exporting to JPEG.</div>
        </div>
      </div>

      <!-- Hidden working canvas -->
      <canvas id="canvas" style="display:none"></canvas>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById('file');
    const dropzone = document.getElementById('dropzone');
    const formatSel = document.getElementById('format');
    const qualityRange = document.getElementById('quality');
    const qualityValue = document.getElementById('qualityValue');
    const convertBtn = document.getElementById('convertBtn');
    const resetBtn = document.getElementById('resetBtn');
    const preview = document.getElementById('preview');
    const meta = document.getElementById('meta');
    const dimsEl = document.getElementById('dims');
    const origSizeEl = document.getElementById('origSize');
    const outSizeEl = document.getElementById('outSize');
    const noteEl = document.getElementById('note');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    let originalFile = null;
    let imgEl = null;
    let originalBytes = 0;

    // Feature detection for AVIF/WebP; remove unsupported options
    (async function detectFormats(){
      const test = (type) => new Promise(res => {
        const c = document.createElement('canvas');
        c.width = c.height = 2;
        c.toBlob(b => res(!!b), type);
      });
      const avifOK = await test('image/avif');
      if(!avifOK){
        [...formatSel.options].forEach(o=>{ if(o.value==='image/avif') o.textContent+=' (unsupported)'; });
      }
      const webpOK = await test('image/webp');
      if(!webpOK){
        [...formatSel.options].forEach(o=>{ if(o.value==='image/webp') o.textContent+=' (unsupported)'; });
      }
    })();

    // Helper: format bytes
    const fmtBytes = (n) => {
      if(!n && n!==0) return '—';
      const units=['B','KB','MB'];
      let i=0; let v=n;
      while(v>=1024 && i<units.length-1){ v/=1024; i++; }
      return `${v.toFixed(v<10?2:1)} ${units[i]}`;
    };

    // Update quality pill
    const updateQualityPill = () => {
      qualityValue.textContent = Math.round(parseFloat(qualityRange.value)*100) + '%';
    };
    qualityRange.addEventListener('input', updateQualityPill);
    updateQualityPill();

    // Drag & drop
    ;['dragenter','dragover'].forEach(ev=> dropzone.addEventListener(ev, e=>{ e.preventDefault(); dropzone.style.background='#e0f2ff'; }));
    ;['dragleave','drop'].forEach(ev=> dropzone.addEventListener(ev, e=>{ e.preventDefault(); dropzone.style.background='#f0f9ff'; }));
    dropzone.addEventListener('drop', (e)=>{
      const f = e.dataTransfer.files?.[0];
      if(f) handleFile(f);
    });

    dropzone.addEventListener('click', ()=> fileInput.click());
    fileInput.addEventListener('change', (e)=>{
      const f = e.target.files?.[0];
      if(f) handleFile(f);
    });

    function resetUI(){
      originalFile = null;
      originalBytes = 0;
      if(imgEl){ URL.revokeObjectURL(imgEl.src); }
      preview.innerHTML = '<span class="dz-hint">Your preview will appear here</span>';
      meta.hidden = true;
      convertBtn.disabled = true;
      resetBtn.disabled = true;
      outSizeEl.textContent = '—';
    }

    resetBtn.addEventListener('click', resetUI);

    async function handleFile(file){
      if(!file.type.startsWith('image/')){
        alert('Please upload an image file.');
        return;
      }
      originalFile = file;
      originalBytes = file.size;

      // Show preview image
      if(imgEl){ URL.revokeObjectURL(imgEl.src); }
      imgEl = new Image();
      imgEl.loading = 'eager';
      imgEl.decoding = 'async';
      imgEl.alt = 'Preview';
      imgEl.src = URL.createObjectURL(file);
      imgEl.onload = ()=>{
        // Show in preview box
        preview.innerHTML = '';
        preview.appendChild(imgEl);
        meta.hidden = false;
        dimsEl.textContent = `${imgEl.naturalWidth} × ${imgEl.naturalHeight}px`;
        origSizeEl.textContent = `Original: ${fmtBytes(originalBytes)}`;
        outSizeEl.textContent = 'Converted: —';
        noteEl.textContent = file.type || 'Unknown';
        convertBtn.disabled = false;
        resetBtn.disabled = false;
      };
    }

    async function convert(){
      if(!originalFile || !imgEl) return;
      const type = formatSel.value;
      const q = parseFloat(qualityRange.value);

      // Size canvas to image
      canvas.width = imgEl.naturalWidth;
      canvas.height = imgEl.naturalHeight;

      // If exporting to JPEG (no transparency), fill white background
      if(type === 'image/jpeg'){
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0,0,canvas.width, canvas.height);
      } else {
        ctx.clearRect(0,0,canvas.width, canvas.height);
      }
      ctx.drawImage(imgEl, 0, 0);

      // Convert via canvas.toBlob
      canvas.toBlob(async (blob)=>{
        if(!blob){
          alert('This format may not be supported in your browser. Try a different one.');
          return;
        }
        // Update UI with size
        outSizeEl.textContent = `Converted: ${fmtBytes(blob.size)}`;
        noteEl.textContent = type.replace('image/','').toUpperCase() + ` • Q${Math.round(q*100)}`;

        // Download
        const ext = {
          'image/jpeg':'jpg', 'image/png':'png', 'image/webp':'webp', 'image/avif':'avif'
        }[type] || 'img';
        const base = (originalFile.name.split('.').slice(0,-1).join('.') || 'image');
        const outName = `${base}.${ext}`;

        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = outName; document.body.appendChild(a); a.click(); a.remove();
        setTimeout(()=> URL.revokeObjectURL(url), 1000);
      }, type, ['image/png'].includes(type) ? undefined : q);
    }

    convertBtn.addEventListener('click', convert);
  </script>
</body>
</html>
