<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- üü¶ SEO & META TAGS -->
    <title>Online Image Resizer Tool | Bulk Resize, Compress & Convert Images Free ‚Äì multiimagex.online</title>
    <meta name="description" content="Free online image resizer tool by multiimagex.online. Resize, compress, convert, crop, and optimize unlimited images at once. Fast, secure, mobile-friendly, and 100% client-side.">
    <meta name="keywords" content="image resizer, photo resizer, bulk image resizer, online image resize, image compressor, image converter, resize jpg, resize png, convert to webp, crop image tool, optimize images, reduce image size, multiimagex.online">
    <meta name="robots" content="index, follow">
    <meta name="author" content="multiimagex.online">
    <link rel="canonical" href="https://multiimagex.online/image-resizer">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Online Image Resizer Tool | Bulk Resize & Compress">
    <meta property="og:description" content="Resize, compress, and convert unlimited images for free in your browser.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://multiimagex.online">
    <meta property="og:image" content="https://multiimagex.online/assets/resizer-og.jpg">

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "SoftwareApplication",
          "name": "Online Image Resizer",
          "applicationCategory": "MultimediaApplication",
          "operatingSystem": "Any",
          "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" }
        },
        {
          "@type": "FAQPage",
          "mainEntity": [
            {
              "@type": "Question",
              "name": "How do I resize multiple images at once?",
              "acceptedAnswer": { "@type": "Answer", "text": "Simply drag and drop all your images into the upload area, set your desired width/height or percentage, and click 'Process All Images'. The tool will resize them all in a batch." }
            },
            {
              "@type": "Question",
              "name": "Is my data safe?",
              "acceptedAnswer": { "@type": "Answer", "text": "Yes! This tool runs 100% in your browser. Your images are never uploaded to any server." }
            },
            {
              "@type": "Question",
              "name": "Can I convert PNG to JPG?",
              "acceptedAnswer": { "@type": "Answer", "text": "Yes, you can convert between JPG, PNG, and WEBP formats easily." }
            }
          ]
        }
      ]
    }
    </script>

    <!-- External Libraries (Loaded via CDN for stability & performance) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* üü¶ CSS STYLES */
        :root {
            --primary: #4F46E5;
            --primary-hover: #4338ca;
            --bg: #F9FAFB;
            --surface: #FFFFFF;
            --text: #1F2937;
            --text-secondary: #6B7280;
            --border: #E5E7EB;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }

        /* Layout */
        .container { max-width: 1280px; margin: 0 auto; padding: 20px; }
        
        header { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; margin-bottom: 30px; }
        .logo { font-size: 1.5rem; font-weight: 700; color: var(--primary); text-decoration: none; }
        
        /* Upload Section */
        .upload-zone {
            background: var(--surface);
            border: 2px dashed var(--primary);
            border-radius: var(--radius);
            padding: 60px 20px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
            margin-bottom: 30px;
        }
        .upload-zone:hover, .upload-zone.dragover { background: #EEF2FF; }
        .upload-icon { font-size: 48px; color: var(--primary); margin-bottom: 15px; }
        .btn-upload {
            background: var(--primary); color: white; padding: 12px 30px; border-radius: 30px;
            font-weight: 600; border: none; cursor: pointer; font-size: 1rem; margin-top: 15px;
        }
        #fileInput { display: none; }

        /* Workspace (Hidden Initially) */
        .workspace { display: grid; grid-template-columns: 320px 1fr; gap: 30px; display: none; }
        
        /* Sidebar Controls */
        .sidebar { background: var(--surface); padding: 25px; border-radius: var(--radius); box-shadow: var(--shadow); height: fit-content; }
        .control-group { margin-bottom: 25px; border-bottom: 1px solid var(--border); padding-bottom: 20px; }
        .control-group:last-child { border-bottom: none; }
        .control-title { font-weight: 700; font-size: 0.95rem; margin-bottom: 15px; display: flex; justify-content: space-between; }
        
        label { display: block; font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px; }
        input[type="number"], select { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-family: inherit; margin-bottom: 10px; }
        
        .input-row { display: flex; gap: 10px; }
        .range-wrap { display: flex; align-items: center; gap: 10px; }
        input[type="range"] { flex: 1; }
        
        .btn-process {
            width: 100%; background: var(--primary); color: white; padding: 15px; 
            border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1rem;
            transition: 0.2s;
        }
        .btn-process:hover { background: var(--primary-hover); }
        .btn-process:disabled { background: #ccc; cursor: not-allowed; }

        /* Image Grid */
        .image-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
        .image-card {
            background: var(--surface); border-radius: 8px; overflow: hidden;
            box-shadow: var(--shadow); position: relative; transition: 0.2s;
        }
        .image-card:hover { transform: translateY(-2px); }
        .thumb-box { height: 140px; background: #eee; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; }
        .thumb-box img { width: 100%; height: 100%; object-fit: cover; }
        .card-info { padding: 10px; font-size: 0.8rem; }
        .file-name { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: 600; }
        .file-meta { color: var(--text-secondary); font-size: 0.75rem; display: flex; justify-content: space-between; margin-top: 4px; }
        
        .card-actions {
            position: absolute; top: 5px; right: 5px; display: flex; gap: 5px;
        }
        .btn-icon {
            background: rgba(0,0,0,0.6); color: white; border: none; width: 28px; height: 28px;
            border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 14px; transition: 0.2s;
        }
        .btn-icon:hover { background: var(--primary); }

        /* Progress Bar */
        .progress-area { margin-bottom: 20px; display: none; }
        .progress-bar { width: 100%; height: 8px; background: #E5E7EB; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }
        .progress-text { text-align: center; font-size: 0.9rem; margin-top: 5px; font-weight: 500; }

        /* Modal (Cropper) */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 1000; display: none;
            align-items: center; justify-content: center;
        }
        .modal-content {
            background: white; padding: 20px; border-radius: var(--radius);
            width: 90%; max-width: 800px; max-height: 90vh; display: flex; flex-direction: column;
        }
        .crop-container { height: 60vh; background: #333; overflow: hidden; }
        .crop-controls { padding: 15px 0 0; display: flex; justify-content: space-between; gap: 10px; flex-wrap: wrap; }
        .btn-secondary { background: #E5E7EB; color: var(--text); padding: 8px 15px; border-radius: 6px; border: none; cursor: pointer; }
        .btn-secondary:hover { background: #d1d5db; }

        /* SEO Content */
        .seo-content { margin-top: 60px; background: var(--surface); padding: 40px; border-radius: var(--radius); }
        .seo-content h2 { margin-top: 25px; margin-bottom: 15px; color: var(--primary); }
        .seo-content p, .seo-content li { color: #4B5563; margin-bottom: 10px; }
        .faq-item { border-bottom: 1px solid var(--border); padding: 15px 0; }
        .faq-question { font-weight: 600; cursor: pointer; display: flex; justify-content: space-between; }
        .faq-answer { margin-top: 10px; display: none; color: var(--text-secondary); }
        
        footer { text-align: center; padding: 40px; color: var(--text-secondary); font-size: 0.9rem; margin-top: 40px; border-top: 1px solid var(--border); }

        @media (max-width: 768px) {
            .workspace { grid-template-columns: 1fr; }
            .sidebar { order: 2; }
            .image-grid { order: 1; grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- Header -->
        <header>
            <a href="#" class="logo">multiimagex.online</a>
        </header>

        <!-- Upload Area -->
        <div class="upload-zone" id="dropZone">
            <div class="upload-icon">üìÅ</div>
            <h2>Drag & Drop Images Here</h2>
            <p style="color: #9CA3AF; margin-bottom: 20px;">Supports JPG, PNG, WEBP, GIF (Unlimited Uploads)</p>
            <button class="btn-upload" onclick="document.getElementById('fileInput').click()">Select Images</button>
            <input type="file" id="fileInput" multiple accept="image/*">
        </div>

        <!-- Main Workspace -->
        <div class="workspace" id="workspace">
            
            <!-- Sidebar Controls -->
            <aside class="sidebar">
                <div class="control-group">
                    <div class="control-title">Resize Options</div>
                    <label>Resize Mode</label>
                    <select id="resizeMode">
                        <option value="dimensions">Width & Height (px)</option>
                        <option value="percentage">Percentage (%)</option>
                    </select>

                    <div id="dimOptions">
                        <div class="input-row">
                            <input type="number" id="widthInput" placeholder="Width">
                            <input type="number" id="heightInput" placeholder="Height">
                        </div>
                        <label><input type="checkbox" id="aspectRatio" checked> Maintain Aspect Ratio</label>
                        <select id="presetRatio" style="margin-top:10px;">
                            <option value="">Custom Ratio</option>
                            <option value="1">1:1 (Square)</option>
                            <option value="1.333">4:3 (Standard)</option>
                            <option value="1.777">16:9 (Widescreen)</option>
                            <option value="0.5625">9:16 (Mobile Story)</option>
                        </select>
                    </div>

                    <div id="percOptions" style="display:none;">
                        <div class="range-wrap">
                            <input type="range" id="percRange" min="1" max="100" value="75">
                            <span id="percValue">75%</span>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <div class="control-title">Format & Compression</div>
                    <label>Output Format</label>
                    <select id="formatInput">
                        <option value="original">Keep Original</option>
                        <option value="image/jpeg">JPG</option>
                        <option value="image/png">PNG</option>
                        <option value="image/webp">WEBP</option>
                    </select>

                    <label>Quality: <span id="qualityValue">90%</span></label>
                    <input type="range" id="qualityInput" min="10" max="100" value="90">
                    <div style="font-size:0.75rem; color:var(--text-secondary);">Lower quality = Smaller file size</div>
                </div>

                <div class="progress-area" id="progressArea">
                    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
                    <div class="progress-text" id="progressText">Processing...</div>
                </div>

                <button class="btn-process" id="processBtn">‚ö° Process All Images</button>
                <button class="btn-process" id="downloadZipBtn" style="display:none; margin-top:10px; background:#10B981;">üì• Download ZIP</button>
            </aside>

            <!-- Image Grid -->
            <main>
                <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                    <h3 id="fileCount">0 Images Selected</h3>
                    <button onclick="clearAll()" style="color:#EF4444; background:none; border:none; cursor:pointer; font-weight:600;">Clear All</button>
                </div>
                <div class="image-grid" id="imageGrid">
                    <!-- Thumbnails injected via JS -->
                </div>
            </main>
        </div>

        <!-- SEO Content -->
        <article class="seo-content">
            <h1>Online Image Resizer Tool - Resize, Compress & Convert</h1>
            <p>Welcome to <strong>multiimagex.online</strong>, the best free online image resizer. Our tool allows you to bulk resize, compress, and convert photos directly in your browser without uploading them to a server.</p>
            
            <h2>Why use multiimagex.online Image Resizer?</h2>
            <ul>
                <li><strong>100% Private:</strong> All processing happens locally on your device.</li>
                <li><strong>Bulk Processing:</strong> Resize 50+ images at once with a single click.</li>
                <li><strong>Advanced Formatting:</strong> Convert JPG to PNG, PNG to WEBP, and more.</li>
                <li><strong>Fast & Free:</strong> No limits on file size or quantity.</li>
            </ul>

            <h2>How to Resize Images Online?</h2>
            <ol style="margin-left:20px; margin-bottom:20px;">
                <li>Drag and drop your photos into the upload box.</li>
                <li>Choose your desired dimensions (pixels or percentage).</li>
                <li>Adjust quality settings to compress file size.</li>
                <li>Click "Process All" and download your optimized images.</li>
            </ol>

            <h2>Frequently Asked Questions</h2>
            <div class="faq-item">
                <div class="faq-question" onclick="toggleFaq(this)">Is this tool free? <span>+</span></div>
                <div class="faq-answer">Yes, multiimagex.online is completely free to use for unlimited images.</div>
            </div>
            <div class="faq-item">
                <div class="faq-question" onclick="toggleFaq(this)">Does it reduce image quality? <span>+</span></div>
                <div class="faq-answer">You have full control! Use the quality slider to balance between file size and image clarity.</div>
            </div>
            <div class="faq-item">
                <div class="faq-question" onclick="toggleFaq(this)">Can I use this on mobile? <span>+</span></div>
                <div class="faq-answer">Absolutely. The tool is fully responsive and works great on iPhone and Android.</div>
            </div>
        </article>
    </div>

    <!-- Footer -->
    <footer>
        &copy; 2024 multiimagex.online - Free Image Tools. All rights reserved.
    </footer>

    <!-- Crop Modal -->
    <div class="modal" id="cropModal">
        <div class="modal-content">
            <h3 style="margin-bottom:10px;">Crop Image</h3>
            <div class="crop-container">
                <img id="cropImage" src="" style="max-width:100%;">
            </div>
            <div class="crop-controls">
                <div>
                    <button class="btn-secondary" onclick="cropper.setAspectRatio(1)">1:1</button>
                    <button class="btn-secondary" onclick="cropper.setAspectRatio(16/9)">16:9</button>
                    <button class="btn-secondary" onclick="cropper.setAspectRatio(4/5)">4:5 (IG)</button>
                    <button class="btn-secondary" onclick="cropper.setAspectRatio(NaN)">Free</button>
                </div>
                <div>
                    <button class="btn-secondary" style="background:#EF4444; color:white;" onclick="closeModal()">Cancel</button>
                    <button class="btn-secondary" style="background:var(--primary); color:white;" onclick="saveCrop()">Save Crop</button>
                </div>
            </div>
        </div>
    </div>

    <!-- üü¶ JAVASCRIPT LOGIC -->
    <script>
        // --- STATE MANAGEMENT ---
        let uploadedFiles = []; // Stores { id, file, originalSrc, processedBlob, name, type }
        let cropper = null;
        let currentCropId = null;

        // --- DOM ELEMENTS ---
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const workspace = document.getElementById('workspace');
        const imageGrid = document.getElementById('imageGrid');
        const fileCountLabel = document.getElementById('fileCount');
        const processBtn = document.getElementById('processBtn');
        const downloadZipBtn = document.getElementById('downloadZipBtn');

        // --- SETTINGS ELEMENTS ---
        const resizeMode = document.getElementById('resizeMode');
        const dimOptions = document.getElementById('dimOptions');
        const percOptions = document.getElementById('percOptions');
        const widthInput = document.getElementById('widthInput');
        const heightInput = document.getElementById('heightInput');
        const aspectRatioCheck = document.getElementById('aspectRatio');
        const presetRatio = document.getElementById('presetRatio');
        const percRange = document.getElementById('percRange');
        const percValue = document.getElementById('percValue');
        const formatInput = document.getElementById('formatInput');
        const qualityInput = document.getElementById('qualityInput');
        const qualityValue = document.getElementById('qualityValue');

        // --- EVENT LISTENERS ---
        
        // Upload Handling
        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'););
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });
        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

        // Settings Logic
        resizeMode.addEventListener('change', (e) => {
            if(e.target.value === 'dimensions') {
                dimOptions.style.display = 'block';
                percOptions.style.display = 'none';
            } else {
                dimOptions.style.display = 'none';
                percOptions.style.display = 'block';
            }
        });

        percRange.addEventListener('input', (e) => percValue.textContent = e.target.value + '%');
        qualityInput.addEventListener('input', (e) => qualityValue.textContent = e.target.value + '%');

        widthInput.addEventListener('input', () => {
            if(aspectRatioCheck.checked && uploadedFiles.length > 0 && widthInput.value) {
                // Use aspect ratio of FIRST image as reference for UI calculation
                const img = new Image();
                img.src = uploadedFiles[0].originalSrc;
                img.onload = () => {
                    const ratio = img.height / img.width;
                    heightInput.value = Math.round(widthInput.value * ratio);
                }
            }
        });

        processBtn.addEventListener('click', processAllImages);
        downloadZipBtn.addEventListener('click', downloadZip);

        // --- CORE FUNCTIONS ---

        function handleFiles(files) {
            if(files.length === 0) return;
            workspace.style.display = 'grid';
            dropZone.style.display = 'none'; // Compact view if wanted, or keep top
            dropZone.innerHTML = `<div style="display:flex; align-items:center; justify-content:center; gap:10px;"><span style="font-size:24px;">‚ûï</span> <b>Add more files</b></div>`;
            dropZone.style.padding = "20px";

            Array.from(files).forEach(file => {
                if(!file.type.startsWith('image/')) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const fileObj = {
                        id: Date.now() + Math.random().toString(16).slice(2),
                        file: file,
                        originalSrc: e.target.result,
                        currentSrc: e.target.result, // Used for display (can be cropped)
                        name: file.name,
                        type: file.type,
                        size: file.size,
                        processedBlob: null
                    };
                    uploadedFiles.push(fileObj);
                    addCardToGrid(fileObj);
                    updateCount();
                    
                    // Set initial width input if empty
                    if(uploadedFiles.length === 1 && !widthInput.value) {
                         const img = new Image();
                         img.onload = () => { widthInput.value = img.width; heightInput.value = img.height; };
                         img.src = e.target.result;
                    }
                };
                reader.readAsDataURL(file);
            });
        }

        function addCardToGrid(fileObj) {
            const card = document.createElement('div');
            card.className = 'image-card';
            card.id = `card-${fileObj.id}`;
            card.innerHTML = `
                <div class="thumb-box">
                    <img src="${fileObj.currentSrc}" id="img-${fileObj.id}">
                    <div class="card-actions">
                        <button class="btn-icon" title="Crop" onclick="openCrop('${fileObj.id}')">‚úÇÔ∏è</button>
                        <button class="btn-icon" title="Remove" onclick="removeFile('${fileObj.id}')">‚úï</button>
                    </div>
                </div>
                <div class="card-info">
                    <div class="file-name">${fileObj.name}</div>
                    <div class="file-meta">
                        <span>${(fileObj.size/1024).toFixed(1)} KB</span>
                        <span class="status-text" id="status-${fileObj.id}">Ready</span>
                    </div>
                </div>
            `;
            imageGrid.appendChild(card);
        }

        function removeFile(id) {
            uploadedFiles = uploadedFiles.filter(f => f.id !== id);
            document.getElementById(`card-${id}`).remove();
            updateCount();
            if(uploadedFiles.length === 0) clearAll();
        }

        function clearAll() {
            uploadedFiles = [];
            imageGrid.innerHTML = '';
            workspace.style.display = 'none';
            dropZone.style.display = 'block';
            dropZone.innerHTML = `<div class="upload-icon">üìÅ</div><h2>Drag & Drop Images Here</h2><p style="color: #9CA3AF; margin-bottom: 20px;">Supports JPG, PNG, WEBP, GIF</p><button class="btn-upload" onclick="document.getElementById('fileInput').click()">Select Images</button>`;
            dropZone.style.padding = "60px 20px";
            downloadZipBtn.style.display = 'none';
        }

        function updateCount() {
            fileCountLabel.textContent = `${uploadedFiles.length} Images Selected`;
        }

        // --- CROP LOGIC ---
        function openCrop(id) {
            currentCropId = id;
            const fileObj = uploadedFiles.find(f => f.id === id);
            const image = document.getElementById('cropImage');
            image.src = fileObj.currentSrc;
            
            document.getElementById('cropModal').style.display = 'flex';
            
            if(cropper) cropper.destroy();
            cropper = new Cropper(image, {
                viewMode: 1,
                autoCropArea: 0.9
            });
        }

        function saveCrop() {
            if(!cropper) return;
            const canvas = cropper.getCroppedCanvas();
            const newSrc = canvas.toDataURL();
            
            // Update model
            const fileObj = uploadedFiles.find(f => f.id === currentCropId);
            fileObj.currentSrc = newSrc;
            
            // Update View
            document.getElementById(`img-${currentCropId}`).src = newSrc;
            
            closeModal();
        }

        function closeModal() {
            document.getElementById('cropModal').style.display = 'none';
            if(cropper) cropper.destroy();
        }

        // --- BATCH PROCESSING LOGIC ---
        async function processAllImages() {
            if(uploadedFiles.length === 0) return;

            // UI Updates
            processBtn.disabled = true;
            document.getElementById('progressArea').style.display = 'block';
            downloadZipBtn.style.display = 'none';

            const settings = {
                mode: resizeMode.value,
                width: parseInt(widthInput.value),
                height: parseInt(heightInput.value),
                percent: parseInt(percRange.value),
                maintainAspect: aspectRatioCheck.checked,
                format: formatInput.value,
                quality: parseInt(qualityInput.value) / 100
            };

            let completed = 0;

            for(let i = 0; i < uploadedFiles.length; i++) {
                const fileObj = uploadedFiles[i];
                const statusEl = document.getElementById(`status-${fileObj.id}`);
                statusEl.textContent = 'Processing...';
                statusEl.style.color = 'orange';

                try {
                    fileObj.processedBlob = await processImage(fileObj, settings);
                    
                    // Update UI
                    statusEl.textContent = `Done (${(fileObj.processedBlob.size/1024).toFixed(1)} KB)`;
                    statusEl.style.color = 'green';
                } catch (err) {
                    console.error(err);
                    statusEl.textContent = 'Error';
                    statusEl.style.color = 'red';
                }

                completed++;
                const percent = (completed / uploadedFiles.length) * 100;
                document.getElementById('progressFill').style.width = `${percent}%`;
                document.getElementById('progressText').innerText = `Processed ${completed}/${uploadedFiles.length}`;
            }

            processBtn.disabled = false;
            processBtn.innerText = "Process Again";
            downloadZipBtn.style.display = 'block';
        }

        function processImage(fileObj, settings) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.src = fileObj.currentSrc; // Use currentSrc (handles crops)
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');

                    let targetW = img.width;
                    let targetH = img.height;

                    // Calculate Dimensions
                    if(settings.mode === 'percentage') {
                        const ratio = settings.percent / 100;
                        targetW = img.width * ratio;
                        targetH = img.height * ratio;
                    } else {
                        if(settings.width && settings.height && !settings.maintainAspect) {
                            targetW = settings.width;
                            targetH = settings.height;
                        } else if (settings.width && settings.maintainAspect) {
                            const ratio = img.height / img.width;
                            targetW = settings.width;
                            targetH = settings.width * ratio;
                        } else if (settings.height && settings.maintainAspect) {
                            const ratio = img.width / img.height;
                            targetH = settings.height;
                            targetW = settings.height * ratio;
                        }
                    }

                    canvas.width = targetW;
                    canvas.height = targetH;

                    // High Quality Scaling
                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';
                    ctx.drawImage(img, 0, 0, targetW, targetH);

                    // Determine Format
                    let mime = settings.format === 'original' ? fileObj.type : settings.format;
                    if(mime === 'image/jpg') mime = 'image/jpeg';

                    // Export Blob
                    canvas.toBlob(blob => {
                        resolve(blob);
                    }, mime, settings.quality);
                };
                img.onerror = reject;
            });
        }

        // --- DOWNLOAD LOGIC ---
        async function downloadZip() {
            const zip = new JSZip();
            const folder = zip.folder("resized_images");

            uploadedFiles.forEach((fileObj, index) => {
                if(fileObj.processedBlob) {
                    // Determine extension
                    let ext = fileObj.processedBlob.type.split('/')[1];
                    if(ext === 'jpeg') ext = 'jpg';
                    
                    let name = fileObj.name;
                    // Remove old extension
                    name = name.substring(0, name.lastIndexOf('.')) || name;
                    
                    folder.file(`${name}_resized.${ext}`, fileObj.processedBlob);
                }
            });

            const content = await zip.generateAsync({type:"blob"});
            saveAs(content, "multiimagex_resized.zip");
        }

        // FAQ Toggle
        function toggleFaq(el) {
            const answer = el.nextElementSibling;
            if(answer.style.display === 'block') {
                answer.style.display = 'none';
                el.querySelector('span').textContent = '+';
            } else {
                answer.style.display = 'block';
                el.querySelector('span').textContent = '-';
            }
        }

        // Load Saved Settings (Simple LocalStorage)
        window.onload = () => {
            const savedW = localStorage.getItem('lastWidth');
            if(savedW) widthInput.value = savedW;
        }
        widthInput.addEventListener('change', () => localStorage.setItem('lastWidth', widthInput.value));

    </script>
</body>
</html>
