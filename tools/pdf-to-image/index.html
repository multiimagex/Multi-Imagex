<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="favicon-16x16.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO & Meta Tags -->
    <title>multiimagex.online ‚Äî Free Online PDF to Image Converter (JPG, PNG)</title>
    <meta name="description" content="Convert PDF to Image instantly with multiimagex.online. Free unlimited PDF to JPG / PNG converter. Secure, offline, high-quality, and works on mobile & desktop.">
    <meta name="keywords" content="pdf to image, pdf to jpg, pdf to png, convert pdf to image, convert pdf pages to images, free pdf to image online, best pdf image converter, image converter online, high quality pdf to jpg, multiimagex.online pdf tools, pdf converter online">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://multiimagex.online/pdf-to-image">
    
    <!-- Open Graph -->
    <meta property="og:title" content="multiimagex.online ‚Äî Free Online PDF to Image Converter">
    <meta property="og:description" content="Turn PDF pages into high-quality Images (PNG/JPG) instantly in your browser. Private, fast, and free.">
    <meta property="og:image" content="https://multiimagex.online/assets/og-pdf-image.jpg">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://multiimagex.online">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Free PDF to Image Converter">
    <meta name="twitter:description" content="Convert PDF to JPG/PNG safely in your browser. No upload to server.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">

    <!-- Libraries (Loaded from CDN for stability & speed) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- JSON-LD Structure Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "WebPage",
          "name": "Free PDF to Image Converter - multiimagex.online",
          "description": "Convert PDF files to high-quality JPG or PNG images securely in your browser.",
          "url": "https://multiimagex.online"
        },
        {
          "@type": "SoftwareApplication",
          "name": "PDF to Image Converter",
          "operatingSystem": "All",
          "applicationCategory": "UtilitiesApplication",
          "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
          }
        },
        {
          "@type": "FAQPage",
          "mainEntity": [{
            "@type": "Question",
            "name": "Is this PDF to Image converter free?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Yes, multiimagex.online is 100% free to use with no hidden limits."
            }
          }, {
            "@type": "Question",
            "name": "Is it secure?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Absolutely. All conversions happen locally in your browser. Your files are never uploaded to any server."
            }
          }]
        }
      ]
    }
    </script>

    <style>
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --secondary: #ec4899;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
        }

        h1, h2, h3 { font-family: 'Poppins', sans-serif; color: var(--text-main); }
        
        /* Layout */
        .container { max-width: 1100px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 40px 0 20px; }
        header h1 { font-size: 2.5rem; font-weight: 700; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px; }
        header p { color: var(--text-muted); font-size: 1.1rem; }

        /* Upload Area */
        .upload-area {
            background: var(--card-bg);
            border: 2px dashed var(--primary);
            border-radius: var(--radius);
            padding: 50px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 30px;
            position: relative;
        }
        .upload-area:hover, .upload-area.dragover { background: #eff6ff; border-color: var(--primary-hover); }
        .upload-icon { font-size: 48px; margin-bottom: 15px; color: var(--primary); }
        .upload-btn {
            background: var(--primary); color: white; padding: 12px 30px;
            border: none; border-radius: 50px; font-weight: 600; font-size: 1rem;
            cursor: pointer; margin-top: 15px; transition: transform 0.2s;
        }
        .upload-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }
        #fileInput { display: none; }

        /* Controls Section */
        .controls-section {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            display: none; /* Hidden initially */
        }
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .control-group { display: flex; flex-direction: column; }
        .control-group label { font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; color: var(--text-muted); }
        select, input[type="text"], input[type="number"] {
            padding: 10px; border: 1px solid var(--border); border-radius: 8px;
            font-family: 'Inter', sans-serif; font-size: 0.95rem;
        }
        
        /* Grid Preview */
        .preview-container { display: none; margin-bottom: 40px; }
        .preview-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;}
        .selection-tools { display: flex; gap: 10px; align-items: center; }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
        }
        .page-card {
            background: var(--card-bg); border-radius: 8px; overflow: hidden;
            box-shadow: var(--shadow); position: relative; cursor: pointer;
            transition: transform 0.2s, border 0.2s; border: 2px solid transparent;
        }
        .page-card.selected { border-color: var(--primary); transform: scale(1.02); }
        .page-card img { width: 100%; height: auto; display: block; }
        .page-number {
            position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.6);
            color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem;
        }
        .checkbox-overlay {
            position: absolute; top: 8px; left: 8px; width: 20px; height: 20px;
            border: 2px solid #ddd; background: white; border-radius: 4px;
        }
        .page-card.selected .checkbox-overlay { background: var(--primary); border-color: var(--primary); }
        .page-card.selected .checkbox-overlay::after {
            content: '‚úì'; color: white; position: absolute; top: -2px; left: 3px; font-size: 14px;
        }

        /* Actions */
        .actions-bar { text-align: center; margin-top: 30px; display: none; }
        .btn-action {
            padding: 15px 40px; font-size: 1.1rem; border: none; border-radius: 50px;
            cursor: pointer; font-weight: 700; color: white;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
            transition: all 0.3s;
        }
        .btn-action:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .btn-secondary {
            background: #fff; color: var(--text-main); border: 1px solid var(--border);
            padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; margin-right: 5px;
        }
        .btn-secondary:hover { background: #f1f5f9; }

        /* Progress & Status */
        .status-msg { text-align: center; margin: 20px 0; font-weight: 600; color: var(--primary); display: none; }
        .error-msg { color: #ef4444; }
        
        /* SEO Content */
        .seo-content {
            margin-top: 80px; padding-top: 40px; border-top: 1px solid var(--border);
            background: #fff; padding: 40px; border-radius: var(--radius);
        }
        .seo-content h2 { margin-top: 30px; margin-bottom: 15px; font-size: 1.8rem; }
        .seo-content p { margin-bottom: 15px; color: #475569; }
        .seo-content ul { margin-left: 20px; margin-bottom: 20px; color: #475569; }
        .seo-content li { margin-bottom: 8px; }

        footer { text-align: center; padding: 30px; color: var(--text-muted); font-size: 0.9rem; margin-top: 50px; }

        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1); width: 36px; height: 36px;
            border-radius: 50%; border-left-color: var(--primary);
            animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; margin-right: 10px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        @media (max-width: 768px) {
            header h1 { font-size: 1.8rem; }
            .controls-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>PDF to Image Converter</h1>
            <p>Convert unlimited PDF pages to high-quality JPG or PNG instantly.</p>
        </header>

        <!-- Upload Section -->
        <div class="upload-area" id="dropZone">
            <div class="upload-icon">üìÅ</div>
            <h3>Drag & Drop PDF file here</h3>
            <p style="color: #94a3b8; margin-bottom: 15px;">or click to browse</p>
            <button class="upload-btn" onclick="document.getElementById('fileInput').click()">Select PDF File</button>
            <input type="file" id="fileInput" accept=".pdf">
            <div id="fileInfo" style="margin-top: 15px; font-weight: 600; color: var(--text-main);"></div>
        </div>

        <div id="statusArea" class="status-msg"></div>

        <!-- Settings Section -->
        <div class="controls-section" id="controlsSection">
            <h3 style="margin-bottom: 20px;">Conversion Settings</h3>
            <div class="controls-grid">
                <!-- Format -->
                <div class="control-group">
                    <label>Output Format</label>
                    <select id="formatSelect">
                        <option value="png">PNG (High Quality)</option>
                        <option value="jpeg">JPG (Small Size)</option>
                    </select>
                </div>
                
                <!-- Quality (JPG only) -->
                <div class="control-group">
                    <label>JPG Quality</label>
                    <select id="qualitySelect">
                        <option value="0.92">High (Recommended)</option>
                        <option value="0.7">Medium</option>
                        <option value="0.5">Low</option>
                    </select>
                </div>

                <!-- Scale -->
                <div class="control-group">
                    <label>Resolution Scale</label>
                    <select id="scaleSelect">
                        <option value="1">1x (Standard)</option>
                        <option value="1.5" selected>1.5x (Sharp)</option>
                        <option value="2">2x (Ultra HD)</option>
                    </select>
                </div>

                <!-- Rotation -->
                <div class="control-group">
                    <label>Page Rotation</label>
                    <select id="rotationSelect">
                        <option value="0">0¬∞ (Normal)</option>
                        <option value="90">90¬∞ Clockwise</option>
                        <option value="180">180¬∞ Upside Down</option>
                        <option value="270">270¬∞ Counter-Clockwise</option>
                    </select>
                </div>
            </div>

            <!-- Watermark Settings -->
            <h4 style="margin: 15px 0 10px; color: var(--primary);">Watermark Options (Optional)</h4>
            <div class="controls-grid">
                <div class="control-group">
                    <label>Watermark Text</label>
                    <input type="text" id="wmText" placeholder="e.g. Confidential">
                </div>
                <div class="control-group">
                    <label>Position</label>
                    <select id="wmPosition">
                        <option value="center">Center</option>
                        <option value="top-left">Top Left</option>
                        <option value="bottom-right">Bottom Right</option>
                    </select>
                </div>
            </div>

            <!-- Merge Option -->
            <div style="margin-top: 10px;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="mergeCheck" style="margin-right: 10px; width: 18px; height: 18px;">
                    <span style="font-weight: 600;">Merge selected pages into one long image?</span>
                </label>
            </div>
        </div>

        <!-- Preview Section -->
        <div class="preview-container" id="previewContainer">
            <div class="preview-header">
                <h3>Select Pages to Convert</h3>
                <div class="selection-tools">
                    <button class="btn-secondary" id="btnSelectAll">Select All</button>
                    <button class="btn-secondary" id="btnDeselectAll">None</button>
                    <input type="text" id="rangeInput" placeholder="e.g. 1-3, 5" style="width: 120px; padding: 6px;">
                    <button class="btn-secondary" id="btnApplyRange">Apply</button>
                </div>
            </div>
            <div class="grid" id="thumbnailGrid"></div>
        </div>

        <!-- Convert Button -->
        <div class="actions-bar" id="actionsBar">
            <button class="btn-action" id="convertBtn">Convert & Download</button>
        </div>

        <!-- SEO Content -->
        <article class="seo-content">
            <h2>About the PDF to Image Converter</h2>
            <p>Welcome to <strong>multiimagex.online</strong>, your ultimate destination for file conversion tools. Our <strong>PDF to Image Converter</strong> allows you to transform PDF documents into high-quality PNG or JPG images instantly. Unlike other tools, this converter runs entirely in your web browser, ensuring fast performance and complete privacy.</p>

            <h2>Why Use multiimagex.online?</h2>
            <p>Whether you need to convert a single page or a 100-page document, our tool handles it with ease. We prioritized speed, security, and ease of use to create the <strong>best PDF image converter</strong> available online.</p>
            
            <h3>Key Advantages:</h3>
            <ul>
                <li><strong>100% Free & Unlimited:</strong> No daily limits, no hidden costs.</li>
                <li><strong>Privacy First:</strong> Your files are processed client-side. No data is sent to our servers.</li>
                <li><strong>High Quality PDF to JPG:</strong> Choose output resolution up to 2x for crystal clear images.</li>
                <li><strong>Works Offline:</strong> Once loaded, the tool works without an internet connection.</li>
                <li><strong>Mobile Friendly:</strong> Fully optimized for iPhone, Android, Tablets, and Desktops.</li>
            </ul>

            <h2>How to Convert PDF Pages to Images</h2>
            <ol style="margin-left: 20px; margin-bottom: 20px; color: #475569;">
                <li><strong>Upload:</strong> Drag and drop your PDF file or click to select one.</li>
                <li><strong>Preview:</strong> View thumbnails of all pages and select the ones you want.</li>
                <li><strong>Customize:</strong> Adjust format (PNG/JPG), quality, rotation, or add a watermark.</li>
                <li><strong>Convert:</strong> Click "Convert & Download" to save individual images or a ZIP file.</li>
            </ol>

            <h2>Supported Formats</h2>
            <p>Our tool supports all standard PDF files including scanned documents, text-heavy reports, and graphical presentations. You can export to:</p>
            <ul>
                <li><strong>JPG / JPEG:</strong> Best for photographs and smaller file sizes.</li>
                <li><strong>PNG:</strong> Best for text documents requiring high fidelity and transparency support.</li>
            </ul>

            <h2>Frequently Asked Questions</h2>
            <div itemscope itemtype="https://schema.org/FAQPage">
                <div itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                    <h4 itemprop="name">Is it safe to convert sensitive PDFs here?</h4>
                    <div itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer">
                        <p itemprop="text">Yes! We use advanced browser-based technology (WebAssembly/JS). Your PDF file never leaves your device, making it completely secure for sensitive documents.</p>
                    </div>
                </div>
                <div itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                    <h4 itemprop="name">Can I convert a PDF with password protection?</h4>
                    <div itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer">
                        <p itemprop="text">Yes, if you know the password. The tool will prompt you to enter the password to unlock and process the file.</p>
                    </div>
                </div>
                <div itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
                    <h4 itemprop="name">How many pages can I convert at once?</h4>
                    <div itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer">
                        <p itemprop="text">There is no hard limit. We have optimized the tool to handle 50+ pages smoothly, depending on your device's memory.</p>
                    </div>
                </div>
            </div>
            
            <p style="margin-top: 30px;">
                <a href="https://multiimagex.online" style="color: var(--primary); text-decoration: none; font-weight: 700;">Explore more tools at multiimagex.online</a>
            </p>
        </article>
    </div>

    <footer>
        &copy; 2025 multiimagex.online. All rights reserved. | <a href="#" style="color:inherit">Privacy Policy</a>
    </footer>

    <script>
        // --- Configuration & State ---
        // Point to CDN for the PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        let pdfDoc = null;
        let selectedPages = new Set();
        let totalPages = 0;
        let fileName = "";

        // --- DOM Elements ---
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const controlsSection = document.getElementById('controlsSection');
        const previewContainer = document.getElementById('previewContainer');
        const thumbnailGrid = document.getElementById('thumbnailGrid');
        const actionsBar = document.getElementById('actionsBar');
        const statusArea = document.getElementById('statusArea');
        const convertBtn = document.getElementById('convertBtn');

        // --- Event Listeners ---
        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length) handleFile(files[0]);
        });
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) handleFile(e.target.files[0]);
        });

        // Selection Tools
        document.getElementById('btnSelectAll').addEventListener('click', () => {
            for(let i=1; i<=totalPages; i++) selectedPages.add(i);
            updateVisualSelection();
        });
        document.getElementById('btnDeselectAll').addEventListener('click', () => {
            selectedPages.clear();
            updateVisualSelection();
        });
        document.getElementById('btnApplyRange').addEventListener('click', applyRange);
        
        // Convert Action
        convertBtn.addEventListener('click', startConversion);

        // --- Core Functions ---

        async function handleFile(file) {
            if (file.type !== 'application/pdf') {
                showStatus('Error: Please upload a valid PDF file.', true);
                return;
            }

            // Reset UI
            fileName = file.name.replace('.pdf', '');
            fileInfo.innerText = `Selected: ${file.name} (${(file.size/1024/1024).toFixed(2)} MB)`;
            showStatus(`<div class="spinner"></div> Loading PDF...`, false);
            thumbnailGrid.innerHTML = '';
            selectedPages.clear();
            
            try {
                const arrayBuffer = await file.arrayBuffer();
                const loadingTask = pdfjsLib.getDocument(arrayBuffer);
                
                loadingTask.onPassword = function (updatePassword, reason) {
                    const password = prompt(reason === pdfjsLib.PasswordResponses.NEED_PASSWORD ? 
                        'Enter password to open this PDF:' : 'Invalid password. Try again:');
                    updatePassword(password);
                };

                pdfDoc = await loadingTask.promise;
                totalPages = pdfDoc.numPages;

                showStatus(`Loaded ${totalPages} pages. Generating previews...`, false);
                
                // Render Thumbnails
                await renderThumbnails();
                
                // Show Controls
                controlsSection.style.display = 'block';
                previewContainer.style.display = 'block';
                actionsBar.style.display = 'block';
                showStatus('', false); // Clear status

            } catch (error) {
                console.error(error);
                showStatus('Error loading PDF. File might be corrupt or password protected.', true);
            }
        }

        async function renderThumbnails() {
            // Use a generator or chunking to prevent UI freeze on large PDFs
            for (let i = 1; i <= totalPages; i++) {
                selectedPages.add(i); // Select all by default
                await createThumbnail(i);
            }
        }

        async function createThumbnail(pageNum) {
            const page = await pdfDoc.getPage(pageNum);
            const viewport = page.getViewport({ scale: 0.3 }); // Low scale for thumb
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            await page.render({ canvasContext: ctx, viewport: viewport }).promise;

            const div = document.createElement('div');
            div.className = 'page-card selected';
            div.dataset.page = pageNum;
            div.onclick = () => toggleSelection(pageNum, div);
            
            const img = document.createElement('img');
            img.src = canvas.toDataURL();
            
            const numBadge = document.createElement('div');
            numBadge.className = 'page-number';
            numBadge.innerText = `Page ${pageNum}`;

            const check = document.createElement('div');
            check.className = 'checkbox-overlay';

            div.appendChild(img);
            div.appendChild(numBadge);
            div.appendChild(check);
            thumbnailGrid.appendChild(div);
            
            // Memory cleanup
            canvas.remove();
        }

        function toggleSelection(num, element) {
            if (selectedPages.has(num)) {
                selectedPages.delete(num);
                element.classList.remove('selected');
            } else {
                selectedPages.add(num);
                element.classList.add('selected');
            }
        }

        function updateVisualSelection() {
            const cards = document.querySelectorAll('.page-card');
            cards.forEach(card => {
                const num = parseInt(card.dataset.page);
                if (selectedPages.has(num)) card.classList.add('selected');
                else card.classList.remove('selected');
            });
        }

        function applyRange() {
            const range = document.getElementById('rangeInput').value;
            if (!range) return;
            
            selectedPages.clear();
            const parts = range.split(',');
            
            parts.forEach(part => {
                if (part.includes('-')) {
                    const [start, end] = part.split('-').map(n => parseInt(n.trim()));
                    if (!isNaN(start) && !isNaN(end)) {
                        for (let i = start; i <= end && i <= totalPages; i++) selectedPages.add(i);
                    }
                } else {
                    const num = parseInt(part.trim());
                    if (!isNaN(num) && num <= totalPages) selectedPages.add(num);
                }
            });
            updateVisualSelection();
        }

        function showStatus(msg, isError) {
            statusArea.style.display = msg ? 'block' : 'none';
            statusArea.innerHTML = msg;
            statusArea.className = isError ? 'status-msg error-msg' : 'status-msg';
        }

        // --- Conversion Logic ---

        async function startConversion() {
            if (selectedPages.size === 0) {
                alert("Please select at least one page.");
                return;
            }

            convertBtn.disabled = true;
            convertBtn.innerText = "Converting...";
            showStatus('<div class="spinner"></div> Processing images, please wait...', false);

            // Settings
            const format = document.getElementById('formatSelect').value;
            const quality = parseFloat(document.getElementById('qualitySelect').value);
            const scale = parseFloat(document.getElementById('scaleSelect').value);
            const rotation = parseInt(document.getElementById('rotationSelect').value);
            const wmText = document.getElementById('wmText').value.trim();
            const wmPos = document.getElementById('wmPosition').value;
            const merge = document.getElementById('mergeCheck').checked;

            const zip = new JSZip();
            const sortedPages = Array.from(selectedPages).sort((a, b) => a - b);
            const outputImages = []; // Store blobs for merging

            try {
                for (const pageNum of sortedPages) {
                    const page = await pdfDoc.getPage(pageNum);
                    const viewport = page.getViewport({ scale: scale, rotation: rotation + page.rotate }); // Add user rotation + doc rotation
                    
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = viewport.width;
                    canvas.height = viewport.height;

                    await page.render({ canvasContext: ctx, viewport: viewport }).promise;

                    // Apply Watermark
                    if (wmText) {
                        ctx.font = `bold ${viewport.width * 0.05}px Arial`;
                        ctx.fillStyle = "rgba(128, 128, 128, 0.5)";
                        ctx.textAlign = wmPos === 'center' ? 'center' : (wmPos.includes('right') ? 'right' : 'left');
                        ctx.textBaseline = wmPos === 'center' ? 'middle' : (wmPos.includes('bottom') ? 'bottom' : 'top');
                        
                        let x = wmPos.includes('left') ? 20 : (wmPos.includes('right') ? canvas.width - 20 : canvas.width / 2);
                        let y = wmPos.includes('top') ? 20 : (wmPos.includes('bottom') ? canvas.height - 20 : canvas.height / 2);
                        
                        ctx.fillText(wmText, x, y);
                    }

                    // Export
                    if (merge) {
                        outputImages.push(canvas);
                    } else {
                        const blob = await new Promise(resolve => canvas.toBlob(resolve, `image/${format}`, quality));
                        if (sortedPages.length === 1) {
                            // Single download
                            saveAs(blob, `${fileName}_page_${pageNum}.${format === 'jpeg' ? 'jpg' : 'png'}`);
                        } else {
                            // Add to zip
                            zip.file(`${fileName}_page_${pageNum}.${format === 'jpeg' ? 'jpg' : 'png'}`, blob);
                        }
                    }
                }

                if (merge && outputImages.length > 0) {
                    // Create merged canvas
                    const totalHeight = outputImages.reduce((sum, cvs) => sum + cvs.height, 0);
                    const maxWidth = Math.max(...outputImages.map(cvs => cvs.width));
                    
                    const mergedCanvas = document.createElement('canvas');
                    mergedCanvas.width = maxWidth;
                    mergedCanvas.height = totalHeight;
                    const mCtx = mergedCanvas.getContext('2d');
                    
                    // Fill white background
                    mCtx.fillStyle = "#FFFFFF";
                    mCtx.fillRect(0,0, maxWidth, totalHeight);

                    let currentY = 0;
                    outputImages.forEach(cvs => {
                        // Center smaller images if widths differ
                        const xOffset = (maxWidth - cvs.width) / 2;
                        mCtx.drawImage(cvs, xOffset, currentY);
                        currentY += cvs.height;
                    });

                    const blob = await new Promise(resolve => mergedCanvas.toBlob(resolve, `image/${format}`, quality));
                    saveAs(blob, `${fileName}_merged.${format === 'jpeg' ? 'jpg' : 'png'}`);
                } 
                else if (sortedPages.length > 1 && !merge) {
                    // Download Zip
                    showStatus('Zipping files...', false);
                    const content = await zip.generateAsync({ type: "blob" });
                    saveAs(content, `${fileName}_converted_images.zip`);
                }

                showStatus('Conversion Complete!', false);

            } catch (err) {
                console.error(err);
                showStatus('An error occurred during conversion.', true);
            } finally {
                convertBtn.disabled = false;
                convertBtn.innerText = "Convert & Download";
            }
        }

        function saveAs(blob, name) {
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = name;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
