<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PDF Merger & Splitter</title>
  <style>
    :root {
      --blue: #0ea5ff; /* bright blue */
      --blue-700: #0369a1;
      --bg: #ffffff;
      --ink: #0b1220;
      --muted: #5b7083;
      --card: #ffffff;
      --card-br: #e6f4ff;
      --shadow: 0 10px 30px rgba(14,165,255,.15);
      --radius: 18px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--ink);
      background: linear-gradient(180deg, #f5fbff 0%, #ffffff 60%);
    }
    .wrap{max-width:980px;margin:0 auto;padding:22px;display:grid;gap:18px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;border-radius:14px;background:conic-gradient(from 210deg,var(--blue),#a0e2ff);box-shadow:var(--shadow)}
    h1{margin:0;font-size:clamp(20px,4vw,32px)}

    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{appearance:none;border:1px solid #c7eaff;background:#e8f6ff;color:var(--blue-700);padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
    .tab[aria-selected="true"]{background:var(--blue);color:#fff;border-color:transparent;box-shadow:0 8px 20px rgba(14,165,255,.35)}

    .card{background:var(--card);border:1px solid var(--card-br);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}

    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:920px){.grid{grid-template-columns:1.1fr .9fr}}

    .uploader{border:2px dashed var(--blue);border-radius:var(--radius);padding:20px;text-align:center;background:#f0faff;cursor:pointer}
    input[type=file]{display:none}
    .hint{color:var(--muted);font-size:14px}

    .list{display:grid;gap:10px}
    .item{display:flex;align-items:center;justify-content:space-between;gap:10px;border:1px solid #e7f4ff;background:#ffffff;border-radius:14px;padding:10px 12px}
    .name{font-weight:600}
    .meta{color:var(--muted);font-size:13px}
    .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}

    .num{min-width:80px;padding:8px 10px;border:1px solid #cfeaff;border-radius:10px}

    .btn{appearance:none;border:none;background:var(--blue);color:#fff;padding:12px 16px;border-radius:14px;font-weight:700;cursor:pointer;box-shadow:0 8px 20px rgba(14,165,255,.35)}
    .btn.secondary{background:#e8f6ff;color:var(--blue-700);box-shadow:none;border:1px solid #c7eaff}
    .btn.ghost{background:#ffffff;color:var(--blue-700);border:1px solid #c7eaff}
    .btn:disabled{opacity:.6;cursor:not-allowed}

    .progress{height:10px;background:#eaf6ff;border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0;background:var(--blue);transition:width .2s}

    footer{color:var(--muted);text-align:center;font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand"><div class="logo" aria-hidden="true"></div><h1>PDF Merger & Splitter</h1></div>
      <div class="tabs" role="tablist" aria-label="Mode">
        <button class="tab" id="tab-merge" role="tab" aria-selected="true" aria-controls="panel-merge">Merge</button>
        <button class="tab" id="tab-split" role="tab" aria-selected="false" aria-controls="panel-split">Split</button>
      </div>
    </header>

    <section id="panel-merge" class="card" role="tabpanel" aria-labelledby="tab-merge">
      <div class="grid">
        <div>
          <label class="uploader" id="drop-merge" tabindex="0">
            <input id="files-merge" type="file" accept="application/pdf" multiple />
            <strong>Click to upload</strong> or drag & drop multiple PDFs
            <div class="hint">Order matters — use ▲▼ to reorder</div>
          </label>

          <div class="list" id="merge-list" style="margin-top:12px"></div>

          <div class="row" style="justify-content:space-between;margin-top:10px">
            <div class="row">
              <button id="merge-up" class="btn ghost" type="button">▲ Move Up</button>
              <button id="merge-down" class="btn ghost" type="button">▼ Move Down</button>
              <button id="merge-remove" class="btn ghost" type="button">✕ Remove</button>
            </div>
            <div class="row">
              <button id="merge-clear" class="btn secondary" type="button">Clear</button>
              <button id="merge-btn" class="btn" type="button" disabled>Merge PDFs</button>
            </div>
          </div>

          <div class="row" style="margin-top:8px">
            <div style="flex:1">
              <div class="progress"><div id="merge-bar" class="bar"></div></div>
              <div id="merge-status" class="meta">Waiting for files…</div>
            </div>
            <a id="merge-download" class="btn" href="#" download style="display:none">Download Merged PDF</a>
          </div>
        </div>

        <div>
          <div class="item" style="align-items:flex-start">
            <div>
              <div class="name">Speed Tips</div>
              <div class="meta">We use <strong>pdf-lib</strong> under the hood. Files are combined by copying pages directly (no rasterization), which is extremely fast and keeps text selectable.</div>
            </div>
          </div>
          <div class="item">
            <div class="name">Selected file</div>
            <div class="meta" id="merge-selected">—</div>
          </div>
        </div>
      </div>
    </section>

    <section id="panel-split" class="card" role="tabpanel" aria-labelledby="tab-split" hidden>
      <div class="grid">
        <div>
          <label class="uploader" id="drop-split" tabindex="0">
            <input id="file-split" type="file" accept="application/pdf" />
            <strong>Click to upload</strong> or drag & drop one PDF to split
            <div class="hint">Split into single pages or export a custom page range</div>
          </label>

          <div class="item">
            <div>
              <div class="name">Custom Range</div>
              <div class="meta">Example: <code>1-3,5,8-10</code></div>
            </div>
            <div class="row">
              <input id="range" class="num" placeholder="e.g. 1-3,5" />
              <button id="split-range" class="btn" type="button" disabled>Export Range</button>
            </div>
          </div>

          <div class="row" style="justify-content:space-between;margin-top:10px">
            <div style="flex:1">
              <div class="progress"><div id="split-bar" class="bar"></div></div>
              <div id="split-status" class="meta">Waiting for file…</div>
            </div>
            <a id="split-download" class="btn" href="#" download style="display:none">Download</a>
            <button id="split-all" class="btn secondary" type="button" disabled>Split All (ZIP)</button>
          </div>
        </div>

        <div>
          <div class="item"><div class="name">Pages</div><div class="meta" id="split-pages">—</div></div>
          <div class="item"><div class="name">File</div><div class="meta" id="split-file">—</div></div>
        </div>
      </div>
    </section>

    <footer>All processing happens in your browser. Super fast, private, and mobile-friendly.</footer>
  </div>

  <!-- pdf-lib for ultra-fast PDF manipulation (merge/split) -->
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <!-- JSZip + FileSaver for packaging split pages -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <script>
    // ====== Helpers ======
    const $ = (id) => document.getElementById(id);
    const fmtMB = (b) => (b/1024/1024).toFixed(2) + ' MB';

    // Tabs
    const tabMerge = $('tab-merge');
    const tabSplit = $('tab-split');
    const panelMerge = $('panel-merge');
    const panelSplit = $('panel-split');
    function switchTab(which){
      const isMerge = which==='merge';
      tabMerge.setAttribute('aria-selected', isMerge);
      tabSplit.setAttribute('aria-selected', !isMerge);
      panelMerge.hidden = !isMerge;
      panelSplit.hidden = isMerge;
    }
    tabMerge.addEventListener('click',()=>switchTab('merge'));
    tabSplit.addEventListener('click',()=>switchTab('split'));

    // ====== MERGE ======
    const filesMerge = $('files-merge');
    const dropMerge = $('drop-merge');
    const mergeList = $('merge-list');
    const mergeBtn = $('merge-btn');
    const mergeBar = $('merge-bar');
    const mergeStatus = $('merge-status');
    const mergeDownload = $('merge-download');
    const mergeClear = $('merge-clear');
    const mergeUp = $('merge-up');
    const mergeDown = $('merge-down');
    const mergeRemove = $('merge-remove');
    const mergeSelected = $('merge-selected');

    let mergeFiles = []; // [{file, name, size}]
    let selectedIndex = -1;

    function renderMergeList(){
      mergeList.innerHTML='';
      mergeFiles.forEach((f,idx)=>{
        const el = document.createElement('div');
        el.className='item';
        el.tabIndex=0;
        el.dataset.index=idx;
        el.innerHTML=`<div><div class="name">${f.name}</div><div class="meta">${fmtMB(f.size)}</div></div><div class="meta">#${idx+1}</div>`;
        el.addEventListener('click',()=>selectItem(idx));
        el.addEventListener('keydown',(e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); selectItem(idx);} });
        if(idx===selectedIndex){ el.style.outline='2px solid var(--blue)'; }
        mergeList.appendChild(el);
      });
      mergeBtn.disabled = mergeFiles.length<2;
      mergeClear.disabled = mergeFiles.length===0;
      mergeUp.disabled = mergeDown.disabled = mergeRemove.disabled = selectedIndex<0;
      mergeSelected.textContent = selectedIndex>=0 ? mergeFiles[selectedIndex].name : '—';
    }
    function selectItem(i){ selectedIndex=i; renderMergeList(); }

    function addMergeFiles(fileList){
      for(const f of fileList){ if(f.type==='application/pdf') mergeFiles.push({file:f,name:f.name,size:f.size}); }
      renderMergeList();
      mergeStatus.textContent = mergeFiles.length? 'Ready to merge' : 'Waiting for files…';
      mergeBar.style.width='0%';
      mergeDownload.style.display='none';
    }

    dropMerge.addEventListener('click',()=>filesMerge.click());
    dropMerge.addEventListener('keydown',e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); filesMerge.click(); }});
    filesMerge.addEventListener('change',()=> addMergeFiles(filesMerge.files));
    ;['dragenter','dragover'].forEach(evt=>dropMerge.addEventListener(evt,e=>{e.preventDefault();dropMerge.style.background='#e6f6ff';}));
    ;['dragleave','drop'].forEach(evt=>dropMerge.addEventListener(evt,e=>{e.preventDefault();dropMerge.style.background='#f0faff';}));
    dropMerge.addEventListener('drop',e=> addMergeFiles(e.dataTransfer.files||[]));

    mergeClear.addEventListener('click',()=>{ mergeFiles=[]; selectedIndex=-1; renderMergeList(); mergeDownload.style.display='none'; mergeStatus.textContent='Waiting for files…'; });
    mergeUp.addEventListener('click',()=>{ if(selectedIndex>0){ [mergeFiles[selectedIndex-1], mergeFiles[selectedIndex]] = [mergeFiles[selectedIndex], mergeFiles[selectedIndex-1]]; selectedIndex--; renderMergeList(); }});
    mergeDown.addEventListener('click',()=>{ if(selectedIndex>=0 && selectedIndex<mergeFiles.length-1){ [mergeFiles[selectedIndex+1], mergeFiles[selectedIndex]] = [mergeFiles[selectedIndex], mergeFiles[selectedIndex+1]]; selectedIndex++; renderMergeList(); }});
    mergeRemove.addEventListener('click',()=>{ if(selectedIndex>=0){ mergeFiles.splice(selectedIndex,1); selectedIndex=-1; renderMergeList(); }});

    mergeBtn.addEventListener('click', async ()=>{
      if(mergeFiles.length<2) return;
      mergeBtn.disabled = true; mergeStatus.textContent='Loading PDFs…'; mergeBar.style.width='5%'; mergeDownload.style.display='none';

      // Read all files -> ArrayBuffers in parallel
      const arrays = await Promise.all(mergeFiles.map(f=>f.file.arrayBuffer()));

      // Load source PDFs in parallel for maximum speed
      const { PDFDocument } = PDFLib;
      const srcDocs = await Promise.all(arrays.map(buf=>PDFDocument.load(buf, { updateMetadata:false, ignoreEncryption:true })));

      const outPdf = await PDFDocument.create();
      let copied = 0; const totalPages = (await Promise.all(srcDocs.map(d=>d.getPageCount()))).reduce((a,b)=>a+b,0);

      for(let i=0;i<srcDocs.length;i++){
        const src = srcDocs[i];
        const pages = await outPdf.copyPages(src, Array.from({length:src.getPageCount()}, (_,p)=>p));
        pages.forEach(p=>outPdf.addPage(p));
        copied += pages.length;
        const pct = Math.min(95, Math.round((copied/totalPages)*90)+5);
        mergeBar.style.width = pct+'%';
        mergeStatus.textContent = `Merging… ${copied}/${totalPages} pages`;
        await new Promise(r=>setTimeout(r)); // yield to UI
      }

      mergeStatus.textContent='Finalizing…'; mergeBar.style.width='98%';
      const outBytes = await outPdf.save();
      const blob = new Blob([outBytes], { type:'application/pdf' });
      const url = URL.createObjectURL(blob);
      mergeDownload.href = url; mergeDownload.download = `merged_${Date.now()}.pdf`; mergeDownload.style.display='inline-flex';
      mergeBar.style.width='100%'; mergeStatus.textContent=`Done. ${fmtMB(blob.size)}`;
      mergeBtn.disabled = false;
    });

    // ====== SPLIT ======
    const fileSplit = $('file-split');
    const dropSplit = $('drop-split');
    const splitBar = $('split-bar');
    const splitStatus = $('split-status');
    const splitPages = $('split-pages');
    const splitFile = $('split-file');
    const splitAllBtn = $('split-all');
    const splitRangeBtn = $('split-range');
    const splitDownload = $('split-download');
    const rangeInput = $('range');

    let splitArrayBuffer = null; let splitDoc = null; let splitName = '';

    function handleSplitFile(f){
      if(!f || f.type!=='application/pdf') return;
      splitStatus.textContent = 'Loading PDF…';
      splitArrayBuffer = null; splitDoc = null; splitName = f.name.replace(/\.pdf$/i,'');
      splitDownload.style.display='none'; splitBar.style.width='0%';

      f.arrayBuffer().then(async (buf)=>{
        splitArrayBuffer = buf; const { PDFDocument } = PDFLib;
        splitDoc = await PDFDocument.load(buf, { updateMetadata:false, ignoreEncryption:true });
        splitPages.textContent = splitDoc.getPageCount();
        splitFile.textContent = `${f.name} • ${fmtMB(f.size)}`;
        splitStatus.textContent = 'Ready to split';
        splitAllBtn.disabled = false; splitRangeBtn.disabled = false;
      });
    }

    dropSplit.addEventListener('click',()=>fileSplit.click());
    dropSplit.addEventListener('keydown',e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); fileSplit.click(); }});
    fileSplit.addEventListener('change',()=>handleSplitFile(fileSplit.files?.[0]));
    ;['dragenter','dragover'].forEach(evt=>dropSplit.addEventListener(evt,e=>{e.preventDefault();dropSplit.style.background='#e6f6ff';}));
    ;['dragleave','drop'].forEach(evt=>dropSplit.addEventListener(evt,e=>{e.preventDefault();dropSplit.style.background='#f0faff';}));
    dropSplit.addEventListener('drop',e=>handleSplitFile((e.dataTransfer.files||[])[0]));

    function parseRanges(str, max){
      const set = new Set();
      (str||'').split(',').map(s=>s.trim()).filter(Boolean).forEach(part=>{
        if(/^-?\d+$/.test(part)){
          const n = parseInt(part,10); if(n>=1 && n<=max) set.add(n);
        } else if(/^(\d+)-(\d+)$/.test(part)){
          const [a,b] = part.split('-').map(n=>parseInt(n,10));
          if(a>=1 && b>=a){ for(let i=a;i<=Math.min(b,max);i++) set.add(i); }
        }
      });
      return Array.from(set).sort((a,b)=>a-b);
    }

    splitAllBtn.addEventListener('click', async ()=>{
      if(!splitDoc) return; splitAllBtn.disabled = true; splitRangeBtn.disabled = true; splitDownload.style.display='none';
      splitStatus.textContent='Splitting all pages…'; splitBar.style.width='5%';

      const total = splitDoc.getPageCount();
      const zip = new JSZip();
      const { PDFDocument } = PDFLib;

      // Process in batches to keep UI snappy
      for(let i=0;i<total;i++){
        const out = await PDFDocument.create();
        const [page] = await out.copyPages(splitDoc, [i]);
        out.addPage(page);
        const bytes = await out.save();
        const fname = `${splitName}_page_${String(i+1).padStart(3,'0')}.pdf`;
        zip.file(fname, bytes);
        const pct = Math.min(98, Math.round(((i+1)/total)*90)+5);
        splitBar.style.width = pct+'%';
        splitStatus.textContent = `Adding page ${i+1}/${total}`;
        await new Promise(r=>setTimeout(r));
      }

      splitStatus.textContent='Zipping…'; splitBar.style.width='98%';
      const blob = await zip.generateAsync({ type:'blob' });
      splitDownload.href = URL.createObjectURL(blob);
      splitDownload.download = `${splitName}_pages.zip`;
      splitDownload.textContent = 'Download ZIP';
      splitDownload.style.display='inline-flex';
      splitBar.style.width='100%'; splitStatus.textContent=`Done. ${fmtMB(blob.size)}`;
      splitAllBtn.disabled = false; splitRangeBtn.disabled = false;
    });

    splitRangeBtn.addEventListener('click', async ()=>{
      if(!splitDoc) return; const max = splitDoc.getPageCount();
      const list = parseRanges(rangeInput.value, max).map(n=>n-1); // 0-based indices
      if(!list.length){ alert('Please enter a valid page range, e.g. 1-3,5'); return; }

      splitRangeBtn.disabled=true; splitAllBtn.disabled=true; splitDownload.style.display='none';
      splitStatus.textContent='Exporting range…'; splitBar.style.width='10%';

      const { PDFDocument } = PDFLib;
      const out = await PDFDocument.create();
      const pages = await out.copyPages(splitDoc, list);
      pages.forEach(p=>out.addPage(p));
      splitBar.style.width='70%';
      const bytes = await out.save();
      const blob = new Blob([bytes], { type:'application/pdf' });
      splitDownload.href = URL.createObjectURL(blob);
      splitDownload.download = `${splitName}_range.pdf`;
      splitDownload.textContent = 'Download Range PDF';
      splitDownload.style.display='inline-flex';
      splitBar.style.width='100%'; splitStatus.textContent=`Done. ${fmtMB(blob.size)}`;
      splitRangeBtn.disabled=false; splitAllBtn.disabled=false;
    });
  </script>
</body>
</html>
